(()=>{"use strict";var e,t,r,a,o,n,l,c,i,s,u,h,d,g,f=function(e,t,r,a){return void 0===a&&(a=1),"rgba(".concat(e,",").concat(t,",").concat(r,",").concat(a,")")},v=function(e,t,r,a,o,n){for(var l=e.createLinearGradient(t,r,a,o),c=0,i=n;c<i.length;c++){var s=i[c];l.addColorStop(s.percent,s.color)}return l},p=Object.freeze({gain:.5,numSamples:256}),b=(new Uint8Array(p.numSamples/2),function(e){t.src=e}),m=[],y={visualData:"frequency",showGradient:!0,showPlanets:!0,showCircles:!0,showNoise:!1},S=function(){function e(e){var t=e.xPos,r=e.yPos,a=e.radius,o=e.barWidth,n=e.barMaxHeight,l=e.barPadding,c=e.fillColor;Object.assign(this,{xPos:t,yPos:r,radius:a,barWidth:o,barMaxHeight:n,barPadding:l,fillColor:c})}return e.prototype.draw=function(){c.fillStyle=this.fillColor,c.strokeStyle="white",c.save(),c.translate(this.xPos,this.yPos),c.rotate(g),c.beginPath(),c.arc(0,0,this.radius,0,2*Math.PI),c.fill(),c.stroke(),c.closePath(),c.restore(),w(this.xPos,this.yPos,this.radius,this.barWidth,this.barMaxHeight,this.barPadding,"white")},e.prototype.changeFillColor=function(e){this.fillColor=e},e}(),w=function(e,t,r,a,o,n,l){c.fillStyle=l,c.strokeStyle="black",c.save(),c.translate(e,t),c.rotate(g),c.translate(0,-r);for(var i=0,s=d;i<s.length;i++){var u=s[i]/255;u<.02&&(u=.02),c.translate(a,0),c.rotate(2*Math.PI/128),c.save(),c.scale(1,-1),c.fillRect(0,0,a,o*u),c.restore(),c.translate(n,0)}c.restore()},P=Object.freeze({sound1:"media/DifferentHeaven&SianArea-FeelLikeHorrible.mp3"}),C=function(r){document.querySelector("#btn-fs").onclick=function(e){console.log("goFullscreen() called"),r.requestFullscreen()};var a=document.querySelector("#btn-play");a.onclick=function(r){console.log("audioCtx.state before = ".concat(e.state));var a=r.target;"suspended"==e.state&&e.resume(),console.log("audioCtx.state after = ".concat(e.state)),"no"==a.dataset.playing?(t.play(),a.dataset.playing="yes"):(t.pause(),a.dataset.playing="no")},document.querySelector("#select-track").onchange=function(e){var t=e.target;b(t.value),"yes"==t.dataset.playing&&a.dispatchEvent(new MouseEvent("click"))},document.querySelector("#select-visual").onchange=function(e){var t=e.target;y.visualData=t.value};var o=document.querySelector("#cb-planets"),n=document.querySelector("#cb-core"),l=document.querySelector("#cb-noise");o.onchange=function(e){var t=e.target;y.showPlanets=t.checked},n.onchange=function(e){var t=e.target;y.showCircles=t.checked},l.onchange=function(e){var t=e.target;y.showNoise=t.checked},document.querySelector("#select-theme").onchange=function(e){var t;"none"!=(t=e.target.value)&&(y.showGradient=!0),"evening"==t?(u=v(c,0,0,0,s,[{percent:0,color:"#00101c"},{percent:.33,color:"#041f3a"},{percent:.67,color:"#083f53"},{percent:1,color:"#239294"}]),m[0].changeFillColor("rgba(14, 111, 128, .9)"),m[1].changeFillColor("rgba(27, 45, 112, .9)"),m[2].changeFillColor("rgba(6, 37, 87, .9)")):"midnight"==t?(u=v(c,0,0,0,s,[{percent:0,color:"#070707"},{percent:.5,color:"#1D1D25"},{percent:1,color:"#263242"}]),m[0].changeFillColor("rgba(48, 68, 92, 0.9)"),m[1].changeFillColor("rgba(42, 42, 56, 0.9)"),m[2].changeFillColor("rgba(35, 35, 43, 0.9)")):"morning"==t?(u=v(c,0,0,0,s,[{percent:0,color:"#0087A5"},{percent:.33,color:"#7FACB2"},{percent:.67,color:"#D4C6AB"},{percent:1,color:"#FAAD51"}]),m[0].changeFillColor("rgba(245, 186, 118, 0.9)"),m[1].changeFillColor("rgba(165, 204, 207, 0.9)"),m[2].changeFillColor("rgba(15, 141, 166, 0.9)")):"afternoon"==t?(u=v(c,0,0,0,s,[{percent:0,color:"#3B589E"},{percent:.33,color:"#6A719F"},{percent:.67,color:"#B28393"},{percent:1,color:"#EC5065"}]),m[0].changeFillColor("rgba(245, 144, 145, 0.9)"),m[1].changeFillColor("rgba(172, 156, 184, 0.9)"),m[2].changeFillColor("rgba(95, 122, 194, 0.9)")):"none"==t&&(y.showGradient=!1,m[0].changeFillColor("white"),m[1].changeFillColor("white"),m[2].changeFillColor("white"))}},q=function(){setTimeout(q,1e3/60),function(){if("frequency"==y.visualData?h.getByteFrequencyData(d):"time-domain"==y.visualData&&h.getByteTimeDomainData(d),c.save(),c.fillStyle="black",c.globalAlpha=.1,c.fillRect(0,0,i,s),c.restore(),y.showGradient&&(c.save(),c.fillStyle=u,c.globalAlpha=.3,c.fillRect(0,0,i,s),c.restore()),y.showCircles){var e=s/4;c.save(),c.globalAlpha=.5;for(var t=0;t<d.length;t++){var r=d[t]/255,a=r*e;c.beginPath(),c.fillStyle=f(210,210,210,.34-r/3),c.arc(i/2,s/2,a,0,2*Math.PI,!1),c.fill(),c.closePath(),c.beginPath(),c.fillStyle=f(180,180,180,.1-r/10),c.arc(i/2,s/2,1.5*a,0,2*Math.PI,!1),c.fill(),c.closePath(),c.save(),c.beginPath(),c.fillStyle=f(240,240,240,.5-r/5),c.arc(i/2,s/2,.5*a,0,2*Math.PI,!1),c.fill(),c.closePath(),c.restore()}c.restore()}var o=c.getImageData(0,0,i,s),n=o.data,l=n.length;for(o.width,t=0;t<l;t+=4)y.showNoise&&Math.random()<.05&&(n[t]=n[t+1]=n[t+2]=0,n[t]=255,n[t+1]=255,n[t+2]=255);if(c.putImageData(o,0,0),y.showPlanets)for(var v=0,p=m;v<p.length;v++)p[v].draw();g-=.01}()};window.onload=function(){console.log("window.onload called");var f,y=function(){var t=document.querySelector("#slider-volume"),r=document.querySelector("#label-volume");t.oninput=function(e){var t,a=e.target;t=a.value,t=Number(t),o.gain.value=t,r.innerHTML=String(Math.round(+a.value/2*100))};var a=document.querySelector("#slider-treble"),c=document.querySelector("#label-treble");a.oninput=function(t){var r,a=t.target;r=a.value,n.frequency.setValueAtTime(1e3,e.currentTime),n.gain.setValueAtTime(r,e.currentTime),c.innerHTML=String(Math.round(+a.value/20*100))},a.dispatchEvent(new Event("input"));var i=document.querySelector("#slider-bass"),s=document.querySelector("#label-bass");i.oninput=function(t){var r,a=t.target;r=a.value,l.frequency.setValueAtTime(1e3,e.currentTime),l.gain.setValueAtTime(r,e.currentTime),s.innerHTML=String(Math.round(+a.value/20*100))},i.dispatchEvent(new Event("input"))};(f=new XMLHttpRequest).onload=function(e){!function(e){var t;try{t=JSON.parse(e.target.responseText)}catch(e){return void console.log("JSON parse error!")}document.querySelector("title").innerHTML=t.title;for(var r="",a=0,o=t.tracks;a<o.length;a++){var n=o[a];r+="<option value=".concat(n["track-url"],">").concat(n["track-name"],"</option>")}document.querySelector("#select-track").innerHTML=r;for(var l="| ",c=0,i=t.controls;c<i.length;c++){var s=i[c];l+="".concat(s["control-name"],": <input type=range id=").concat(s["control-id"]," min=").concat(s["control-min"]," max=").concat(s["control-max"]," value=").concat(s["control-value"]," step=0.01>"),l+="<span id=".concat(s["control-label"],">???</span>"),l+=" | "}document.querySelector("#slider-controls").innerHTML=l,y(),document.querySelector("header").innerHTML="<h1>".concat(t.title,"</h1><p>").concat(t.instructions,"</p>")}(e)},f.open("GET","./data/av-data.json"),f.send(),function(){var f,y;console.log("init called"),f=P.sound1,y=window.AudioContext,e=new y,t=new Audio,b(f),r=e.createMediaElementSource(t),(a=e.createAnalyser()).fftSize=p.numSamples,(n=e.createBiquadFilter()).type="highshelf",n.frequency.setValueAtTime(1e3,e.currentTime),(l=e.createBiquadFilter()).type="lowshelf",l.frequency.setValueAtTime(1e3,e.currentTime),(o=e.createGain()).gain.value=p.gain,r.connect(n),n.connect(l),l.connect(a),a.connect(o),o.connect(e.destination);var w=document.querySelector("canvas");C(w),function(e,t){c=e.getContext("2d"),i=e.width,s=e.height,u=v(c,0,0,0,s,[{percent:0,color:"#00101c"},{percent:.33,color:"#041f3a"},{percent:.67,color:"#083f53"},{percent:1,color:"#239294"}]),h=t,d=new Uint8Array(h.fftSize/2),m=[new S({xPos:540,yPos:620,radius:184,barWidth:5,barMaxHeight:100,barPadding:4,fillColor:"rgba(14, 111, 128, .9)"}),new S({xPos:880,yPos:300,radius:120,barWidth:2.9,barMaxHeight:60,barPadding:3,fillColor:"rgba(27, 45, 112, .9)"}),new S({xPos:200,yPos:180,radius:50,barWidth:1.4,barMaxHeight:40,barPadding:1,fillColor:"rgba(6, 37, 87, .9)"})],g=0}(w,a),q()}()}})();
//# sourceMappingURL=bundle.js.map