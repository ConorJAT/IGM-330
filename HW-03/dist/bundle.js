(()=>{"use strict";var e,t,r,a,n,o,l,c,i,s,u,h,d,g,f=[],v={visualData:"frequency",showGradient:!0,showPlanets:!0,showCircles:!0,showNoise:!1},p=function(){function t(e){var t=e.xPos,r=e.yPos,a=e.radius,n=e.barWidth,o=e.barMaxHeight,l=e.barPadding,c=e.fillColor;Object.assign(this,{xPos:t,yPos:r,radius:a,barWidth:n,barMaxHeight:o,barPadding:l,fillColor:c})}return t.prototype.draw=function(){e.fillStyle=this.fillColor,e.strokeStyle="white",e.save(),e.translate(this.xPos,this.yPos),e.rotate(l),e.beginPath(),e.arc(0,0,this.radius,0,2*Math.PI),e.fill(),e.stroke(),e.closePath(),e.restore(),function(t,r,a,n,c,i,s){e.fillStyle="white",e.strokeStyle="black",e.save(),e.translate(t,r),e.rotate(l),e.translate(0,-a);for(var u=0,h=o;u<h.length;u++){var d=h[u]/255;d<.02&&(d=.02),e.translate(n,0),e.rotate(2*Math.PI/128),e.save(),e.scale(1,-1),e.fillRect(0,0,n,c*d),e.restore(),e.translate(i,0)}e.restore()}(this.xPos,this.yPos,this.radius,this.barWidth,this.barMaxHeight,this.barPadding)},t.prototype.changeFillColor=function(e){this.fillColor=e},t}(),b=function(e,t,r,a){return void 0===a&&(a=1),"rgba(".concat(e,",").concat(t,",").concat(r,",").concat(a,")")},m=function(e,t,r,a,n,o){for(var l=e.createLinearGradient(t,r,a,n),c=0,i=o;c<i.length;c++){var s=i[c];l.addColorStop(s.percent,s.color)}return l},y=Object.freeze({gain:.5,numSamples:256}),S=(new Uint8Array(y.numSamples/2),function(e){i.src=e}),w=Object.freeze({sound1:"media/DifferentHeaven&SianArea-FeelLikeHorrible.mp3"}),P=function(t){document.querySelector("#btn-fs").onclick=function(e){console.log("goFullscreen() called"),t.requestFullscreen()};var n=document.querySelector("#btn-play");n.onclick=function(e){var t=e.target;"suspended"==c.state&&c.resume(),"no"==t.dataset.playing?(i.play(),t.dataset.playing="yes"):(i.pause(),t.dataset.playing="no")},document.querySelector("#select-track").onchange=function(e){var t=e.target;S(t.value),"yes"==t.dataset.playing&&n.dispatchEvent(new MouseEvent("click"))},document.querySelector("#select-visual").onchange=function(e){var t=e.target;v.visualData=t.value};var o=document.querySelector("#cb-planets"),l=document.querySelector("#cb-core"),s=document.querySelector("#cb-noise");o.onchange=function(e){var t=e.target;v.showPlanets=t.checked},l.onchange=function(e){var t=e.target;v.showCircles=t.checked},s.onchange=function(e){var t=e.target;v.showNoise=t.checked},document.querySelector("#select-theme").onchange=function(t){var n;"none"!=(n=t.target.value)&&(v.showGradient=!0),"evening"==n?(a=m(e,0,0,0,r,[{percent:0,color:"#00101c"},{percent:.33,color:"#041f3a"},{percent:.67,color:"#083f53"},{percent:1,color:"#239294"}]),f[0].changeFillColor("rgba(14, 111, 128, .9)"),f[1].changeFillColor("rgba(27, 45, 112, .9)"),f[2].changeFillColor("rgba(6, 37, 87, .9)")):"midnight"==n?(a=m(e,0,0,0,r,[{percent:0,color:"#070707"},{percent:.5,color:"#1D1D25"},{percent:1,color:"#263242"}]),f[0].changeFillColor("rgba(48, 68, 92, 0.9)"),f[1].changeFillColor("rgba(42, 42, 56, 0.9)"),f[2].changeFillColor("rgba(35, 35, 43, 0.9)")):"morning"==n?(a=m(e,0,0,0,r,[{percent:0,color:"#0087A5"},{percent:.33,color:"#7FACB2"},{percent:.67,color:"#D4C6AB"},{percent:1,color:"#FAAD51"}]),f[0].changeFillColor("rgba(245, 186, 118, 0.9)"),f[1].changeFillColor("rgba(165, 204, 207, 0.9)"),f[2].changeFillColor("rgba(15, 141, 166, 0.9)")):"afternoon"==n?(a=m(e,0,0,0,r,[{percent:0,color:"#3B589E"},{percent:.33,color:"#6A719F"},{percent:.67,color:"#B28393"},{percent:1,color:"#EC5065"}]),f[0].changeFillColor("rgba(245, 144, 145, 0.9)"),f[1].changeFillColor("rgba(172, 156, 184, 0.9)"),f[2].changeFillColor("rgba(95, 122, 194, 0.9)")):"none"==n&&(v.showGradient=!1,f[0].changeFillColor("white"),f[1].changeFillColor("white"),f[2].changeFillColor("white"))}},C=function(){setTimeout(C,1e3/60),function(){if("frequency"==v.visualData?n.getByteFrequencyData(o):"time-domain"==v.visualData&&n.getByteTimeDomainData(o),e.save(),e.fillStyle="black",e.globalAlpha=.1,e.fillRect(0,0,t,r),e.restore(),v.showGradient&&(e.save(),e.fillStyle=a,e.globalAlpha=.3,e.fillRect(0,0,t,r),e.restore()),v.showCircles){var c=r/4;e.save(),e.globalAlpha=.5;for(var i=0;i<o.length;i++){var s=o[i]/255,u=s*c;e.beginPath(),e.fillStyle=b(210,210,210,.34-s/3),e.arc(t/2,r/2,u,0,2*Math.PI,!1),e.fill(),e.closePath(),e.beginPath(),e.fillStyle=b(180,180,180,.1-s/10),e.arc(t/2,r/2,1.5*u,0,2*Math.PI,!1),e.fill(),e.closePath(),e.save(),e.beginPath(),e.fillStyle=b(240,240,240,.5-s/5),e.arc(t/2,r/2,.5*u,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore()}e.restore()}var h=e.getImageData(0,0,t,r),d=h.data,g=d.length;for(h.width,i=0;i<g;i+=4)v.showNoise&&Math.random()<.05&&(d[i]=d[i+1]=d[i+2]=0,d[i]=255,d[i+1]=255,d[i+2]=255);if(e.putImageData(h,0,0),v.showPlanets)for(var p=0,m=f;p<m.length;p++)m[p].draw();l-=.01}()};window.onload=function(){console.log("window.onload called");var v,b=function(){var e=document.querySelector("#slider-volume"),t=document.querySelector("#label-volume");e.oninput=function(e){var r,a=e.target;r=a.value,r=Number(r),h.gain.value=r,t.innerHTML=String(Math.round(+a.value/2*100))};var r=document.querySelector("#slider-treble"),a=document.querySelector("#label-treble");r.oninput=function(e){var t,r=e.target;t=r.value,d.frequency.setValueAtTime(1e3,c.currentTime),d.gain.setValueAtTime(t,c.currentTime),a.innerHTML=String(Math.round(+r.value/20*100))},r.dispatchEvent(new Event("input"));var n=document.querySelector("#slider-bass"),o=document.querySelector("#label-bass");n.oninput=function(e){var t,r=e.target;t=r.value,g.frequency.setValueAtTime(1e3,c.currentTime),g.gain.setValueAtTime(t,c.currentTime),o.innerHTML=String(Math.round(+r.value/20*100))},n.dispatchEvent(new Event("input"))};(v=new XMLHttpRequest).onload=function(e){!function(e){var t;try{t=JSON.parse(e.target.responseText)}catch(e){return void console.log("JSON parse error!")}document.querySelector("title").innerHTML=t.title;for(var r="",a=0,n=t.tracks;a<n.length;a++){var o=n[a];r+="<option value=".concat(o["track-url"],">").concat(o["track-name"],"</option>")}document.querySelector("#select-track").innerHTML=r;for(var l="| ",c=0,i=t.controls;c<i.length;c++){var s=i[c];l+="".concat(s["control-name"],": <input type=range id=").concat(s["control-id"]," min=").concat(s["control-min"]," max=").concat(s["control-max"]," value=").concat(s["control-value"]," step=0.01>"),l+="<span id=".concat(s["control-label"],">???</span>"),l+=" | "}document.querySelector("#slider-controls").innerHTML=l,b(),document.querySelector("header").innerHTML="<h1>".concat(t.title,"</h1><p>").concat(t.instructions,"</p>")}(e)},v.open("GET","./data/av-data.json"),v.send(),function(){var v,b;v=w.sound1,b=window.AudioContext,c=new b,i=new Audio,S(v),s=c.createMediaElementSource(i),(u=c.createAnalyser()).fftSize=y.numSamples,(d=c.createBiquadFilter()).type="highshelf",d.frequency.setValueAtTime(1e3,c.currentTime),(g=c.createBiquadFilter()).type="lowshelf",g.frequency.setValueAtTime(1e3,c.currentTime),(h=c.createGain()).gain.value=y.gain,s.connect(d),d.connect(g),g.connect(u),u.connect(h),h.connect(c.destination);var q=document.querySelector("canvas");P(q),function(c,i){e=c.getContext("2d"),t=c.width,r=c.height,a=m(e,0,0,0,r,[{percent:0,color:"#00101c"},{percent:.33,color:"#041f3a"},{percent:.67,color:"#083f53"},{percent:1,color:"#239294"}]),n=i,o=new Uint8Array(n.fftSize/2),f=[new p({xPos:540,yPos:620,radius:184,barWidth:5,barMaxHeight:100,barPadding:4,fillColor:"rgba(14, 111, 128, .9)"}),new p({xPos:880,yPos:300,radius:120,barWidth:2.9,barMaxHeight:60,barPadding:3,fillColor:"rgba(27, 45, 112, .9)"}),new p({xPos:200,yPos:180,radius:50,barWidth:1.4,barMaxHeight:40,barPadding:1,fillColor:"rgba(6, 37, 87, .9)"})],l=0}(q,u),C()}()}})();
//# sourceMappingURL=bundle.js.map