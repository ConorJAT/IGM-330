(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var t,n,r,o,a,l,c,i,u,s,f,h,d,y,g=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return"rgba(".concat(e,",").concat(t,",").concat(n,",").concat(r,")")},v=function(t,n,r,o,a,l){var c,i=t.createLinearGradient(n,r,o,a),u=function(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,n){if(t){if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,i=!1;return{s:function(){r=r.call(t)},n:function(){var e=r.next();return c=e.done,e},e:function(e){i=!0,l=e},f:function(){try{c||null==r.return||r.return()}finally{if(i)throw l}}}}(l);try{for(u.s();!(c=u.n()).done;){var s=c.value;i.addColorStop(s.percent,s.color)}}catch(e){u.e(e)}finally{u.f()}return i},m=Object.freeze({gain:.5,numSamples:256}),p=(new Uint8Array(m.numSamples/2),function(e){n.src=e});function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==b(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==b(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===b(o)?o:String(o)),r)}var o}var A=[],q=function(){function e(t,n,r,o,a,l,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.xPos=t,this.yPos=n,this.radius=r,this.barWidth=o,this.barMaxHeight=a,this.barPadding=l,this.fillColor=c}var t,n;return t=e,(n=[{key:"draw",value:function(){i.fillStyle=this.fillColor,i.strokeStyle="white",i.save(),i.translate(this.xPos,this.yPos),i.rotate(y),i.beginPath(),i.arc(0,0,this.radius,0,2*Math.PI),i.fill(),i.stroke(),i.closePath(),i.restore(),C(this.xPos,this.yPos,this.radius,this.barWidth,this.barMaxHeight,this.barPadding,"white")}},{key:"changeFillColor",value:function(e){this.fillColor=e}}])&&S(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),C=function(e,t,n,r,o,a,l){i.fillStyle=l,i.strokeStyle="black",i.save(),i.translate(e,t),i.rotate(y),i.translate(0,-n);var c,u=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,a=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw a}}}}(d);try{for(u.s();!(c=u.n()).done;){var s=c.value/255;s<.02&&(s=.02),i.translate(r,0),i.rotate(2*Math.PI/128),i.save(),i.scale(1,-1),i.fillRect(0,0,r,o*s),i.restore(),i.translate(a,0)}}catch(e){u.e(e)}finally{u.f()}i.restore()},F={visualData:"frequency",showGradient:!0,showPlanets:!0,showCircles:!0,showNoise:!1},P=Object.freeze({sound1:"media/DifferentHeaven&SianArea-FeelLikeHorrible.mp3"}),T=function(e){document.querySelector("#btn-fs").onclick=function(t){var n;console.log("goFullscreen() called"),(n=e).requestFullscreen?n.requestFullscreen():n.mozRequestFullscreen?n.mozRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()};var r=document.querySelector("#btn-play");r.onclick=function(e){console.log("audioCtx.state before = ".concat(t.state)),"suspended"==t.state&&t.resume(),console.log("audioCtx.state after = ".concat(t.state)),"no"==e.target.dataset.playing?(n.play(),e.target.dataset.playing="yes"):(n.pause(),e.target.dataset.playing="no")},document.querySelector("#select-track").onchange=function(e){p(e.target.value),"yes"==e.target.dataset.playing&&r.dispatchEvent(new MouseEvent("click"))},document.querySelector("#select-visual").onchange=function(e){F.visualData=e.target.value};var o=document.querySelector("#cb-planets"),a=document.querySelector("#cb-core"),l=document.querySelector("#cb-noise");o.onchange=function(e){return F.showPlanets=e.target.checked},a.onchange=function(e){return F.showCircles=e.target.checked},l.onchange=function(e){return F.showNoise=e.target.checked},document.querySelector("#select-theme").onchange=function(e){!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;"none"!=t&&(e.showGradient=!0),"evening"==t?(f=v(i,0,0,0,s,[{percent:0,color:"#00101c"},{percent:.33,color:"#041f3a"},{percent:.67,color:"#083f53"},{percent:1,color:"#239294"}]),A[0].changeFillColor("rgba(14, 111, 128, .9)"),A[1].changeFillColor("rgba(27, 45, 112, .9)"),A[2].changeFillColor("rgba(6, 37, 87, .9)")):"midnight"==t?(f=v(i,0,0,0,s,[{percent:0,color:"#070707"},{percent:.5,color:"#1D1D25"},{percent:1,color:"#263242"}]),A[0].changeFillColor("rgba(48, 68, 92, 0.9)"),A[1].changeFillColor("rgba(42, 42, 56, 0.9)"),A[2].changeFillColor("rgba(35, 35, 43, 0.9)")):"morning"==t?(f=v(i,0,0,0,s,[{percent:0,color:"#0087A5"},{percent:.33,color:"#7FACB2"},{percent:.67,color:"#D4C6AB"},{percent:1,color:"#FAAD51"}]),A[0].changeFillColor("rgba(245, 186, 118, 0.9)"),A[1].changeFillColor("rgba(165, 204, 207, 0.9)"),A[2].changeFillColor("rgba(15, 141, 166, 0.9)")):"afternoon"==t?(f=v(i,0,0,0,s,[{percent:0,color:"#3B589E"},{percent:.33,color:"#6A719F"},{percent:.67,color:"#B28393"},{percent:1,color:"#EC5065"}]),A[0].changeFillColor("rgba(245, 144, 145, 0.9)"),A[1].changeFillColor("rgba(172, 156, 184, 0.9)"),A[2].changeFillColor("rgba(95, 122, 194, 0.9)")):"none"==t&&(e.showGradient=!1,A[0].changeFillColor("white"),A[1].changeFillColor("white"),A[2].changeFillColor("white"))}(F,e.target.value)}},M=function e(){setTimeout(e,1e3/60),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("frequency"==e.visualData?h.getByteFrequencyData(d):"time-domain"==e.visualData&&h.getByteTimeDomainData(d),i.save(),i.fillStyle="black",i.globalAlpha=.1,i.fillRect(0,0,u,s),i.restore(),e.showGradient&&(i.save(),i.fillStyle=f,i.globalAlpha=.3,i.fillRect(0,0,u,s),i.restore()),e.showCircles){var t=s/4;i.save(),i.globalAlpha=.5;for(var n=0;n<d.length;n++){var r=d[n]/255,o=r*t;i.beginPath(),i.fillStyle=g(210,210,210,.34-r/3),i.arc(u/2,s/2,o,0,2*Math.PI,!1),i.fill(),i.closePath(),i.beginPath(),i.fillStyle=g(180,180,180,.1-r/10),i.arc(u/2,s/2,1.5*o,0,2*Math.PI,!1),i.fill(),i.closePath(),i.save(),i.beginPath(),i.fillStyle=g(240,240,240,.5-r/5),i.arc(u/2,s/2,.5*o,0,2*Math.PI,!1),i.fill(),i.closePath(),i.restore()}i.restore()}for(var a=i.getImageData(0,0,u,s),l=a.data,c=l.length,v=(a.width,0);v<c;v+=4)e.showNoise&&Math.random()<.05&&(l[v]=l[v+1]=l[v+2]=0,l[v]=255,l[v+1]=255,l[v+2]=255);if(i.putImageData(a,0,0),e.showPlanets)for(var m=0,p=A;m<p.length;m++)p[m].draw();y-=.01}(F)};function k(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,a=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw a}}}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}window.onload=function(){console.log("window.onload called");var e,g=function(){var e=document.querySelector("#slider-volume"),n=document.querySelector("#label-volume");e.oninput=function(e){var t;t=e.target.value,t=Number(t),a.gain.value=t,n.innerHTML=Math.round(e.target.value/2*100)};var r=document.querySelector("#slider-treble"),o=document.querySelector("#label-treble");r.oninput=function(e){var n;n=e.target.value,l.frequency.setValueAtTime(1e3,t.currentTime),l.gain.setValueAtTime(n,t.currentTime),o.innerHTML=Math.round(e.target.value/20*100)},r.dispatchEvent(new Event("input"));var i=document.querySelector("#slider-bass"),u=document.querySelector("#label-bass");i.oninput=function(e){var n;n=e.target.value,c.frequency.setValueAtTime(1e3,t.currentTime),c.gain.setValueAtTime(n,t.currentTime),u.innerHTML=Math.round(e.target.value/20*100)},i.dispatchEvent(new Event("input"))};(e=new XMLHttpRequest).onload=function(e){!function(e){var t;try{t=JSON.parse(e.target.responseText)}catch(e){return void console.log("JSON parse error!")}document.querySelector("title").innerHTML=t.title;var n,r="",o=k(t.tracks);try{for(o.s();!(n=o.n()).done;){var a=n.value;r+="<option value=".concat(a["track-url"],">").concat(a["track-name"],"</option>")}}catch(e){o.e(e)}finally{o.f()}document.querySelector("#select-track").innerHTML=r;var l,c="| ",i=k(t.controls);try{for(i.s();!(l=i.n()).done;){var u=l.value;c+="".concat(u["control-name"],": <input type=range id=").concat(u["control-id"]," min=").concat(u["control-min"]," max=").concat(u["control-max"]," value=").concat(u["control-value"]," step=0.01>"),c+="<span id=".concat(u["control-label"],">???</span>"),c+=" | "}}catch(e){i.e(e)}finally{i.f()}document.querySelector("#slider-controls").innerHTML=c,g(),document.querySelector("header").innerHTML="<h1>".concat(t.title,"</h1><p>").concat(t.instructions,"</p>")}(e)},e.open("GET","./data/av-data.json"),e.send(),function(){var e,g;console.log("init called"),e=P.sound1,g=window.AudioContext||window.webkitAudioContext,t=new g,n=new Audio,p(e),r=t.createMediaElementSource(n),(o=t.createAnalyser()).fftSize=m.numSamples,(l=t.createBiquadFilter()).type="highshelf",l.frequency.setValueAtTime(1e3,t.currentTime),(c=t.createBiquadFilter()).type="lowshelf",c.frequency.setValueAtTime(1e3,t.currentTime),(a=t.createGain()).gain.value=m.gain,r.connect(l),l.connect(c),c.connect(o),o.connect(a),a.connect(t.destination);var b=document.querySelector("canvas");T(b),function(e,t){i=e.getContext("2d"),u=e.width,s=e.height,f=v(i,0,0,0,s,[{percent:0,color:"#00101c"},{percent:.33,color:"#041f3a"},{percent:.67,color:"#083f53"},{percent:1,color:"#239294"}]),h=t,d=new Uint8Array(h.fftSize/2),A=[new q(540,620,184,5,100,4,"rgba(14, 111, 128, .9)"),new q(880,300,120,2.9,60,3,"rgba(27, 45, 112, .9)"),new q(200,180,50,1.4,40,1,"rgba(6, 37, 87, .9)")],y=0}(b,o),M()}()}})();